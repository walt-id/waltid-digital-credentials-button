#
# Dev-style container that serves the web demo AND mock backend endpoints.
# Copies only what is needed to install/build the monorepo and run Vite with dcMockPlugin.
#

FROM node:20-alpine
WORKDIR /app

# Workspace manifests
COPY package.json package-lock.json ./

# Required workspaces and fixtures
COPY packages/dc-client packages/dc-client
COPY packages/dc-mock-utils packages/dc-mock-utils
COPY packages/digital-credentials packages/digital-credentials
COPY apps/web-demo apps/web-demo
COPY apps/config apps/config
COPY fixtures fixtures

RUN npm ci

# Build shared packages (needed for @waltid/* symlinks/dist)
RUN npm run build

ENV HOST=0.0.0.0
ENV PORT=80
EXPOSE 80

# Run Vite dev server for web-demo with mock middleware active
CMD ["npm", "run", "dev", "--workspace", "apps/web-demo", "--", "--host", "0.0.0.0", "--port", "80"]
